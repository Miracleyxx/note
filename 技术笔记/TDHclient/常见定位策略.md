
---

# ğŸ§ Linux æ¡Œé¢ç«¯è¿ç»´ä¸æ·±åº¦è°ƒè¯•æ‰‹å†Œ (Kylin/UOS)

> â„¹ï¸ **é€‚ç”¨åœºæ™¯**ï¼šé“¶æ²³éº’éºŸ (Kylin V10)ã€ç»Ÿä¿¡ (UOS) ç­‰å›½äº§ Linux å‘è¡Œç‰ˆã€‚æ¶µç›–å®¢æˆ·ç«¯éƒ¨ç½²é…ç½®ä¸ C++ (Qt/Electron) åº”ç”¨çš„å´©æºƒæ ¸å¿ƒåˆ†æã€‚

## ğŸ› ï¸ ç¬¬ä¸€éƒ¨åˆ†ï¼šéƒ¨ç½²ä¸ç¯å¢ƒé…ç½® (Deployment)

### 1. æ¡Œé¢åº”ç”¨è‡ªå¯åŠ¨é…ç½®

**åŸç†**ï¼šXDG æ¡Œé¢è§„èŒƒã€‚å°† `.desktop` æè¿°æ–‡ä»¶æ”¾å…¥ `~/.config/autostart/` ç›®å½•å³å¯å®ç°ç”¨æˆ·ç™»å½•åè‡ªå¯ã€‚

```shell
# ä¸€é”®é…ç½®è„šæœ¬ (è‡ªåŠ¨å¤„ç†ç›®å½•ä¸å­˜åœ¨çš„æƒ…å†µ)
TARGET_DIR="$HOME/.config/autostart"
SOURCE_FILE="$HOME/Desktop/courtintetim.fusioncloudtribsys.desktop" # æ³¨æ„ï¼šä¸­æ–‡ç¯å¢ƒå¯èƒ½æ˜¯ $HOME/æ¡Œé¢/...

# 1. ç¡®ä¿ç›®å½•å­˜åœ¨
mkdir -p "$TARGET_DIR"

# 2. å¤åˆ¶å¯åŠ¨å¿«æ·æ–¹å¼
cp "$SOURCE_FILE" "$TARGET_DIR/"

# 3. èµ‹æƒ (å¯é€‰ï¼Œä½†æ¨è)
chmod +x "$TARGET_DIR/$(basename "$SOURCE_FILE")"
```

### 2. Electron æ²™ç›’æƒé™ä¿®å¤

**åœºæ™¯**ï¼šElectron åº”ç”¨å¯åŠ¨ç™½å±æˆ–æŠ¥é”™ `The SUID sandbox helper binary was found, but is not configured correctly`ã€‚è¿™æ˜¯å› ä¸º Chrome æ²™ç›’éœ€è¦ SUID æƒé™ã€‚

```shell
# å¿…é¡»ä½¿ç”¨ root æƒé™æ“ä½œ
# 1. ä¿®æ”¹å±ä¸»ä¸º root
sudo chown root /path/to/install/Electron/chrome-sandbox

# 2. èµ‹äºˆ 4755 æƒé™ (SetUID ä½ + rwxr-xr-x)
# 4xxx: SetUIDï¼Œå…è®¸æ™®é€šç”¨æˆ·ä»¥æ–‡ä»¶æ‰€æœ‰è€…(root)çš„èº«ä»½è¿è¡Œå®ƒ
sudo chmod 4755 /path/to/install/Electron/chrome-sandbox
```

### 3. æ°¸ä¹…å…³é—­ Kysec (éº’éºŸå®‰å…¨æœºåˆ¶)

**åœºæ™¯**ï¼šéº’éºŸ V10 SP1 çš„å®‰å…¨æœºåˆ¶å¯èƒ½ä¼šæ‹¦æˆªæœªç­¾åçš„ç¬¬ä¸‰æ–¹é©±åŠ¨æˆ–åº”ç”¨è¡Œä¸ºã€‚

1. **ä¿®æ”¹ GRUB é…ç½®**ï¼š
    
    ```shell
    sudo vim /etc/default/grub
    ```
    
    æ‰¾åˆ° `GRUB_CMDLINE_LINUX_SECURITY` è¡Œï¼Œä¿®æ”¹ä¸ºç©ºï¼š
    
   ```shell
    # ä¿®æ”¹å‰
    GRUB_CMDLINE_LINUX_SECURITY='security=kysec'
    
    # ä¿®æ”¹å (ç¦ç”¨)
    GRUB_CMDLINE_LINUX_SECURITY='security='
    ```
    
1. **æ›´æ–°å¼•å¯¼å¹¶é‡å¯**ï¼š

   ```shell
    sudo update-grub  # é‡æ–°ç”Ÿæˆ grub.cfg
    reboot            # ç«‹å³é‡å¯ç”Ÿæ•ˆ
    ```
    

---

## ğŸ ç¬¬äºŒéƒ¨åˆ†ï¼šå´©æºƒåˆ†æ (Crash Analysis)

> ğŸ’¡ **æ ¸å¿ƒå·¥å…·**ï¼š`coredumpctl` (Systemd çš„ä¸€éƒ¨åˆ†)ã€‚å®ƒæ¯”ä¼ ç»Ÿçš„ `ulimit -c` + `gdb core` æ–¹å¼æ›´ç°ä»£åŒ–ã€ç®¡ç†æ›´æ–¹ä¾¿ã€‚

### 1. åˆ†ææµç¨‹å›¾ (Workflow)

```mermaid
flowchart TD
    Start([ğŸ’¥ ç¨‹åºå´©æºƒ]) --> Config{é…ç½®æ£€æŸ¥}
    Config --> |Check| A[kernel.core_pattern æŒ‡å‘ systemd]
    A --> List[coredumpctl list]
    List --> Identify{è¯†åˆ«å´©æºƒè¿›ç¨‹}
    Identify --> |EXE = startup| MainProc[ä¸»ç¨‹åºå´©æºƒ]
    Identify --> |EXE = qtwebeg| SubProc[æ¸²æŸ“/å­è¿›ç¨‹å´©æºƒ]
    
    MainProc --> Debug[coredumpctl gdb PID]
    SubProc --> Debug
    
    Debug --> BT[è¾“å…¥ bt æŸ¥çœ‹å †æ ˆ]
    BT --> Location([ğŸ“ å®šä½ä»£ç è¡Œå·])
```

### 2. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ Core Dump äº¤ç»™ systemd æ¥ç®¡ï¼Œè€Œä¸æ˜¯ç›´æ¥å†™æ–‡ä»¶ã€‚

```shell
# ä¸´æ—¶ç”Ÿæ•ˆ (é‡å¯å¤±æ•ˆ)
sudo sysctl -w kernel.core_pattern="|/usr/lib/systemd/systemd-coredump %P %u %g %s %t %c %h %e"

# ç¡®è®¤æœåŠ¡çŠ¶æ€
systemctl status systemd-coredump
```

### 3. å®šä½ä¸è°ƒè¯•å®æˆ˜ (Step-by-Step)

#### æ­¥éª¤ Aï¼šæŸ¥å‡¶æ‰‹ (`list`)

æŸ¥çœ‹å´©æºƒå†å²ï¼Œé€šè¿‡ `EXE` åˆ—å¿«é€Ÿåˆ¤æ–­æ˜¯**ä¸»è¿›ç¨‹**è¿˜æ˜¯**WebEngineå­è¿›ç¨‹**æŒ‚äº†ã€‚

```shell
coredumpctl list
```

|**å…³é”®åˆ—**|**å«ä¹‰**|**åˆ†ææŠ€å·§**|
|---|---|---|
|**PID**|è¿›ç¨‹ID|**è®°ä½å®ƒ**ï¼Œåç»­è°ƒè¯•çš„ Keyã€‚|
|**SIG**|ä¿¡å·|`11` (SIGSEGV) = æ®µé”™è¯¯/ç©ºæŒ‡é’ˆï¼›`6` (SIGABRT) = ä¸»åŠ¨å´©æºƒ/æ–­è¨€å¤±è´¥ã€‚|
|**EXE**|è·¯å¾„|`/opt/app/startup` = ä¸»ç¨‹åºæŒ‚äº†ï¼›`/lib/qt/qtwebeg` = ç½‘é¡µæ¸²æŸ“è¿›ç¨‹æŒ‚äº†ã€‚|

#### æ­¥éª¤ Bï¼šçœ‹æ‘˜è¦ (`info`)

ä¸è¿› GDBï¼Œå…ˆçœ‹æ¦‚è§ˆã€‚

```shell
coredumpctl info <PID>
# é‡ç‚¹çœ‹ "Signal" å’Œ "Stack trace" çš„å‰å‡ è¡Œ
```

#### æ­¥éª¤ Cï¼šè¿›ç°åœº (`gdb`)

è‡ªåŠ¨åŠ è½½ Core æ–‡ä»¶å’Œç¬¦å·è¡¨ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚

```shell
# è°ƒè¯•æŒ‡å®š PID
coredumpctl gdb <PID>

# æˆ–è€…è°ƒè¯•æœ€è¿‘ä¸€æ¬¡ qtwebeg çš„å´©æºƒ
coredumpctl gdb qtwebeg
```

#### æ­¥éª¤ Dï¼šæ‰¾ä»£ç  (`bt`)

åœ¨ GDB äº¤äº’ç•Œé¢ `(gdb)` ä¸­è¾“å…¥ï¼š


```Code snippet
bt  # Backtrace (æ ˆå›æº¯)
```

**è§£è¯»ç¤ºä¾‹**ï¼š

```Plaintext
#0  0x00007f... in DoSomething (ptr=0x0) at /project/src/web_engine.cpp:45
                                   ^                     ^
                                ç©ºæŒ‡é’ˆå«Œç–‘             ä»£ç è¡Œå·
```

### 4. å¯¼å‡ºè¯æ®

å¦‚æœéœ€è¦å°† Core æ–‡ä»¶å‘ç»™ç ”å‘å›¢é˜Ÿï¼š

```Bash
# å¯¼å‡ºæœªå‹ç¼©çš„ core æ–‡ä»¶
coredumpctl dump <PID> -o crash_dump.core
```

---

## ğŸ“ ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ—¥å¿—å®¡è®¡ (Log Audit)

å½“å‘ç”Ÿé™é»˜å´©æºƒï¼ˆæ—  Core Dumpï¼‰æˆ–åº”ç”¨å¼‚å¸¸é€€å‡ºæ—¶ï¼Œéœ€ç»“åˆå†…æ ¸æ—¥å¿—æŸ¥è¯ã€‚

### 1. ç»„åˆæŸ¥è¯¢å‘½ä»¤

åŒæ—¶æœç´¢ç³»ç»Ÿæ¶ˆæ¯å’Œå†…æ ¸ç¯å½¢ç¼“å†²åŒºï¼Œè¿‡æ»¤å…³é”®å­— `instance` (é€šå¸¸æ˜¯åº”ç”¨å) æˆ– `QtWebEngine`ã€‚


```shell
# 1. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— (åŒ…å«æœåŠ¡å¯åŠ¨ã€å´©æºƒä¿¡å·)
# -x: è¡¥å……ä¿¡æ¯, -e: è·³è½¬åˆ°æœ«å°¾
journalctl -xe | grep -E "instance|QtWebEngine"

# 2. æŸ¥çœ‹å†…æ ¸æ—¥å¿— (æŸ¥çœ‹ OOM Killã€ç¡¬ä»¶é”™è¯¯ã€æ®µé”™è¯¯åº•å±‚è®°å½•)
dmesg | grep -E "instance|QtWebEngine"
```

> **æ¶æ„å¸ˆæç¤º**ï¼šå¦‚æœ `coredumpctl` æ‰¾ä¸åˆ°è®°å½•ï¼Œä½† `dmesg` é‡Œæœ‰ `Out of memory: Kill process`ï¼Œè¯´æ˜æ˜¯å†…å­˜çˆ†äº†è¢«å†…æ ¸æ€æ‰çš„ï¼Œè¿™ç§æƒ…å†µä¸‹é€šå¸¸ä¸ä¼šäº§ç”Ÿ Core Dumpã€‚