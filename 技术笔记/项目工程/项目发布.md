# 项目发布

## 动态编译版本号

### `window VS2019`版本

1. 版本配置文件

   ```c++
   #ifndef __GIT_VERSION_H__
   #define __GIT_VERSION_H__
   
   #define COMMIT_HASH "@COMMIT_HASH@"
   #define COMMIT_TIME "@COMMIT_TIME@"
   #define BRANCH_NAME "@BRANCH_NAME@"
   #define BUILD_TIME  "@BUILD_TIME@"
   #define BUILD_VERSION "@BUILD_VERSION@"
   
   #endif //__GIT_VERSION_H__
   ```

2. 获取`git`信息脚本

   ```powershell
   $gitHash = $(git rev-parse HEAD)
   $gitBranch = $(git symbolic-ref --short -q HEAD)
   $gitCommitTime = $(git log --format=format:%aI -1)
   $buildTime = Get-Date -Format "yyyy-MM-ddTHH:mm:ss"
   
   
   $gitVersionContent = Get-Content -Path "../../$ProjectDir/version.h.in" -Raw
   $gitVersionContent = $gitVersionContent -replace "@COMMIT_HASH@", $gitHash
   $gitVersionContent = $gitVersionContent -replace "@BRANCH_NAME@", $gitBranch
   $gitVersionContent = $gitVersionContent -replace "@COMMIT_TIME@", $gitCommitTime
   $gitVersionContent = $gitVersionContent -replace "@BUILD_TIME@", $buildTime
   #$gitVersionContent = $gitVersionContent -replace "@BUILD_VERSION@", $buildVersion
   
   $gitVersionContent | Set-Content -Path "../../$ProjectDir/version.h"
   
   ```

3. `vs`调用脚本

   在vs项目配置->属性配置->生成事件->生成前事件，增加如下配置

   ```powershell
   powershell -ExecutionPolicy Bypass -File "$(ProjectDir)generate_git_version.ps1"
   ```

4. 项目调用

   ```C++
   #ifndef DEBUG
   #include "version.h"
   #endif // !DEBUG
   ```

   编译时会生成`version.h`头文件，然后再程序中打印该文件中的信息。

   

### `CMake版本`





