# è¡¥å……åˆ†æï¼šæ ‡å®šæ¨¡å—ä¸æ€§èƒ½è¯„ä¼°

> **PersonTracking é¡¹ç›®æ·±åº¦åˆ†æ - ç¬¬äºŒéƒ¨åˆ†**  
> æ—¥æœŸï¼š2025-12-30

---

## ç›®å½•

1. [Calibration æ ‡å®šæ¨¡å—åˆ†æ](#1-calibration-æ ‡å®šæ¨¡å—åˆ†æ)
2. [æ€§èƒ½ç“¶é¢ˆåˆ†æä¸å¤šè·¯è§†é¢‘æ‰¿è½½èƒ½åŠ›è¯„ä¼°](#2-æ€§èƒ½ç“¶é¢ˆåˆ†æä¸å¤šè·¯è§†é¢‘æ‰¿è½½èƒ½åŠ›è¯„ä¼°)

---

## 1. Calibration æ ‡å®šæ¨¡å—åˆ†æ

### 1.1 æ¨¡å—æ¦‚è¿°

**Calibration æ¨¡å—æ˜¯æ•´ä¸ªç³»ç»Ÿçš„"çœ¼ç›æ ¡å‡†å™¨"**ï¼Œè´Ÿè´£è®¡ç®—ç›¸æœºçš„å†…å‚å’Œå¤–å‚ï¼Œè®©ç³»ç»Ÿèƒ½å¤Ÿå‡†ç¡®åœ°å°†2Då›¾åƒåæ ‡è½¬æ¢ä¸º3Dä¸–ç•Œåæ ‡ã€‚

**æ¯”å–»**ï¼š  
å°±åƒé…çœ¼é•œéœ€è¦éªŒå…‰ä¸€æ ·ï¼Œç›¸æœºåœ¨ä½¿ç”¨å‰éœ€è¦"æ ‡å®š"ï¼Œå‘Šè¯‰ç³»ç»Ÿï¼š
- è¿™ä¸ªç›¸æœºçš„é•œå¤´æœ‰å¤šå°‘ç•¸å˜ï¼Ÿï¼ˆå†…å‚ï¼‰
- è¿™ä¸ªç›¸æœºå®‰è£…åœ¨æˆ¿é—´çš„ä»€ä¹ˆä½ç½®ï¼Ÿæœå‘å“ªé‡Œï¼Ÿï¼ˆå¤–å‚ï¼‰

### 1.2 æ ‡å®šæµç¨‹å›¾

```mermaid
flowchart TD
    Start([å¼€å§‹æ ‡å®š]) --> A[å‡†å¤‡æ ‡å®šæ¿<br/>8Ã—11 æ£‹ç›˜æ ¼]
    A --> B[æ‹æ‘„å†…å‚å›¾ç‰‡<br/>5-20å¼ , å¤šè§’åº¦]
    B --> C[æ‹æ‘„å¤–å‚å›¾ç‰‡<br/>æ ‡å®šæ¿æ”¾åœ¨åœ°é¢åŸç‚¹]
    
    C --> D[æ£€æµ‹æ£‹ç›˜è§’ç‚¹<br/>findChessboardCorners]
    D --> E{æ£€æµ‹æˆåŠŸ?}
    E -->|å¤±è´¥| F[è§’ç‚¹æ ‡å‡†åŒ–<br/>normalize_chessboard_corners]
    E -->|æˆåŠŸ| G[å†…å‚æ ‡å®š<br/>calibrateCamera]
    
    G --> H[è®¡ç®—ç›¸æœºå†…å‚<br/>K, dist_coeffs]
    H --> I[å¤–å‚æ ‡å®š<br/>solvePnP]
    I --> J[è®¡ç®—ç›¸æœºå¤–å‚<br/>rvec, tvec]
    
    J --> K[åæ ‡ç³»è½¬æ¢<br/>board_to_room]
    K --> L[ç”Ÿæˆ camera_params.yaml]
    L --> End([æ ‡å®šå®Œæˆ])
    
    style Start fill:#e1f5e1
    style End fill:#ffe1e1
    style G fill:#e1f0ff
    style I fill:#ffe1f0
    style L fill:#fff4e1
```

### 1.3 æ ¸å¿ƒæ–‡ä»¶èŒè´£

| æ–‡ä»¶å | ä½œç”¨ | å…³é”®å‡½æ•° | è¯´æ˜ |
|--------|------|---------|------|
| `calibration_service.py` | **æ ‡å®šæ ¸å¿ƒé€»è¾‘** | `calibrate()` | å°è£…å®Œæ•´æ ‡å®šæµç¨‹ï¼Œä¾›APIè°ƒç”¨ |
| `api_server.py` | **FastAPIæœåŠ¡** | `POST /api/v1/camera/calibrate` | æ¥æ”¶Base64å›¾ç‰‡ï¼Œè¿”å›æ ‡å®šç»“æœ |
| `calibrate_new.py` | **å‘½ä»¤è¡Œè„šæœ¬** | `run_intrinsic_calibration()`<br/>`run_extrinsic_calibration()` | æœ¬åœ°æ ‡å®šå·¥å…·ï¼Œç”ŸæˆYAMLé…ç½® |

### 1.4 æ ‡å®šåŸç†è¯¦è§£

#### ğŸ“ **å†…å‚æ ‡å®š (Intrinsic Calibration)**

**ç›®æ ‡**ï¼šè®¡ç®—ç›¸æœºçš„ `ç„¦è·`ã€`å…‰å¿ƒä½ç½®`ã€`é•œå¤´ç•¸å˜`

**è¾“å…¥**ï¼š
- 5-20å¼ ä¸åŒè§’åº¦æ‹æ‘„çš„æ£‹ç›˜æ ¼å›¾ç‰‡
- æ£‹ç›˜æ ¼å°ºå¯¸ï¼š8åˆ—Ã—11è¡Œï¼Œæ¯æ ¼60mm

**è¾“å‡º**ï¼š
```yaml
camera_matrix:  # å†…å‚çŸ©é˜µ K (3Ã—3)
  - [fx, 0,  cx]
  - [0,  fy, cy]
  - [0,  0,  1]

dist_coeffs:  # ç•¸å˜ç³»æ•° (5ä¸ª)
  [k1, k2, p1, p2, k3]
```

**å…³é”®æ­¥éª¤**ï¼ˆ`calibration_service.py` ç¬¬173-210è¡Œï¼‰ï¼š

```python
# 1. æ£€æµ‹æ‰€æœ‰å›¾ç‰‡çš„æ£‹ç›˜è§’ç‚¹
for img in intrinsic_images:
    found, corners = self._find_corners(img)  # 88ä¸ªè§’ç‚¹ (8Ã—11)
    if found:
        imgpoints.append(corners)  # 2D å›¾åƒåæ ‡
        objpoints.append(objp)     # 3D ä¸–ç•Œåæ ‡ (å·²çŸ¥)

# 2. ä½¿ç”¨ OpenCV æ±‚è§£å†…å‚
ret, K, dist, rvecs, tvecs = cv2.calibrateCamera(
    objpoints,  # 3D ç‚¹é›†
    imgpoints,  # 2D ç‚¹é›†
    imsize,     # å›¾åƒå°ºå¯¸
    init_camera_matrix,  # åˆå§‹çŒœæµ‹
    None,
    flags=cv2.CALIB_USE_INTRINSIC_GUESS
)
```

**æ•°å­¦åŸç†**ï¼š
```
# é’ˆå­”ç›¸æœºæ¨¡å‹
s * [u]   [fx  0   cx]   [X]
    [v] = [0   fy  cy] * [Y]
    [1]   [0   0   1 ]   [Z]

# é€šè¿‡å¤§é‡æ–¹ç¨‹æ±‚è§£æœ€ä¼˜çš„ fx, fy, cx, cy
# åŒæ—¶è®¡ç®—ç•¸å˜å‚æ•° k1, k2, p1, p2, k3
```

---

#### ğŸ§­ **å¤–å‚æ ‡å®š (Extrinsic Calibration)**

**ç›®æ ‡**ï¼šè®¡ç®—ç›¸æœºåœ¨ä¸–ç•Œåæ ‡ç³»ä¸­çš„ `ä½ç½®` å’Œ `æœå‘`

**è¾“å…¥**ï¼š
- 1å¼ æ ‡å®šæ¿æ”¾åœ¨åœ°é¢åŸç‚¹çš„å›¾ç‰‡
- å·²è®¡ç®—å¥½çš„å†…å‚ `K` å’Œ `dist_coeffs`

**è¾“å‡º**ï¼š
```yaml
rvec:  # æ—‹è½¬å‘é‡ (3Ã—1) - æè¿°ç›¸æœºæœå‘
  - [-0.205]
  - [-1.580]
  - [-2.551]

tvec:  # å¹³ç§»å‘é‡ (3Ã—1) - æè¿°ç›¸æœºä½ç½®
  - [1341.9]  # ç›¸æœºä¸­å¿ƒåœ¨ä¸–ç•Œåæ ‡ç³»çš„ X (mm)
  - [995.5]   # Y (mm)
  - [4188.8]  # Z (mm)
```

**å…³é”®æ­¥éª¤**ï¼ˆ`calibration_service.py` ç¬¬212-238è¡Œï¼‰ï¼š

```python
# 1. æ£€æµ‹æ ‡å®šæ¿åŸç‚¹å›¾ç‰‡çš„è§’ç‚¹
found, corners = self._find_corners(anchor_images[0])

# 2. ä½¿ç”¨ PnP (Perspective-n-Point) ç®—æ³•æ±‚è§£å¤–å‚
success, rvec, tvec = cv2.solvePnP(
    objp,      # 3D ä¸–ç•Œåæ ‡ (88ä¸ªç‚¹)
    corners,   # 2D å›¾åƒåæ ‡ (88ä¸ªç‚¹)
    K,         # å†…å‚çŸ©é˜µ
    dist,      # ç•¸å˜ç³»æ•°
    flags=cv2.SOLVEPNP_ITERATIVE
)
```

**PnP ç®—æ³•åŸç†**ï¼š
- å·²çŸ¥ï¼š88ä¸ª3Dç‚¹åœ¨æ ‡å®šæ¿åæ ‡ç³»çš„ä½ç½® `(X, Y, 0)`
- å·²çŸ¥ï¼šè¿™88ä¸ªç‚¹åœ¨å›¾åƒä¸Šçš„åƒç´ åæ ‡ `(u, v)`
- æ±‚è§£ï¼šç›¸æœºçš„ `R (æ—‹è½¬)` å’Œ `t (å¹³ç§»)`ï¼Œä½¿å¾—æŠ•å½±è¯¯å·®æœ€å°

---

#### ğŸŒ **åæ ‡ç³»è½¬æ¢ (board_to_room)**

**é—®é¢˜**ï¼šæ ‡å®šæ¿åæ ‡ç³» â‰  æˆ¿é—´åæ ‡ç³»

**è§£å†³**ï¼šå¢åŠ ä¸€å±‚è½¬æ¢çŸ©é˜µ

```yaml
board_to_room:
  R:  # æ—‹è½¬çŸ©é˜µ (3Ã—3) - é€šå¸¸æ˜¯å•ä½çŸ©é˜µ (åæ ‡è½´å¹³è¡Œ)
    - [1.0, 0.0, 0.0]
    - [0.0, 1.0, 0.0]
    - [0.0, 0.0, 1.0]
  
  t:  # å¹³ç§»å‘é‡ (3,) - æ ‡å®šæ¿åŸç‚¹åœ¨æˆ¿é—´åæ ‡ç³»çš„ä½ç½®
    - 1246072.0  # Xè½´åç§» (mm)
    - 578116.0   # Yè½´åç§» (mm)
    - 0.0        # Zè½´åç§» (mm)
```

**è½¬æ¢å…¬å¼**ï¼ˆ`geometry.py` ç¬¬153-179è¡Œï¼‰ï¼š
```python
P_room = R @ P_board + t
```

**å®é™…åº”ç”¨**ï¼š
```python
# ä¾‹å¦‚ï¼šæ£€æµ‹åˆ°æŸäººç«™åœ¨æ ‡å®šæ¿åæ ‡ç³»çš„ (1500mm, 2300mm, 0)
P_board = [1500, 2300, 0]

# è½¬æ¢åˆ°æˆ¿é—´åæ ‡ç³»
P_room = [[1, 0, 0],     @ [1500]   + [1246072]   = [1247572]
          [0, 1, 0],       [2300]     [578116]      [580416]
          [0, 0, 1]]       [0]        [0]           [0]

# ç»“æœï¼šæ­¤äººåœ¨æˆ¿é—´çš„ç»å¯¹åæ ‡æ˜¯ (1247.5ç±³, 580.4ç±³)
```

### 1.5 æ ‡å®šæ¥å£ä½¿ç”¨ç¤ºä¾‹

#### **API è°ƒç”¨æ–¹å¼**

```bash
curl -X POST "http://localhost:8080/api/v1/camera/calibrate" \
  -H "Content-Type: application/json" \
  -d '{
    "camera_id": "CAM_001",
    "camera_orientation": "X+Y+",
    "arbitrary_images": [
      "data:image/png;base64,iVBORw0KG...",  # 5-20å¼ å†…å‚å›¾ç‰‡
      "data:image/png;base64,iVBORw0KG...",
      ...
    ],
    "origin_images": [
      "data:image/png;base64,iVBORw0KG..."   # 1å¼ å¤–å‚å›¾ç‰‡ï¼ˆåŸç‚¹ï¼‰
    ],
    "calibration_world_coordinates": [
      [1246072.0, 578116.0, 0.0],  # æ ‡å®šæ¿å·¦ä¸Šè§’
      [1246492.0, 578116.0, 0.0],  # å³ä¸Šè§’
      [1246072.0, 578776.0, 0.0],  # å·¦ä¸‹è§’
      [1246492.0, 578776.0, 0.0]   # å³ä¸‹è§’
    ]
  }'
```

#### **å“åº”æ•°æ®**

```json
{
  "code": 0,
  "message": "æ ‡å®šæˆåŠŸ",
  "timestamp": 1735560000000,
  "data": {
    "camera_id": "CAM_001",
    "camera_matrix": [
      [2053.82, 0.0, 1279.22],
      [0.0, 2077.78, 751.34],
      [0.0, 0.0, 1.0]
    ],
    "dist_coeffs": [-0.266, 0.250, 0.005, -0.015, 0.500],
    "image_width": 2688,
    "image_height": 1520,
    "extrinsics": {
      "rotation_vector": [[-0.205], [-1.580], [-2.551]],
      "translation_vector": [[1341.9], [995.5], [4188.8]]
    },
    "board_to_room": {
      "R": [[1, 0, 0], [0, 1, 0], [0, 0, 1]],
      "T": [1246072.0, 578116.0, 0.0]
    },
    "calibration_time": 2.35
  }
}
```

### 1.6 å…³é”®æŠ€æœ¯ç»†èŠ‚

#### ğŸ” **è§’ç‚¹æ ‡å‡†åŒ– (normalize_chessboard_corners)**

**é—®é¢˜**ï¼šOpenCVæ£€æµ‹åˆ°çš„è§’ç‚¹é¡ºåºä¸ç¡®å®šï¼Œå¯èƒ½ä»å·¦ä¸Šã€å³ä¸Šã€å·¦ä¸‹ã€å³ä¸‹ä»»ä¸€è§’å¼€å§‹

**è§£å†³**ï¼ˆ`calibration_service.py` ç¬¬18-73è¡Œï¼‰ï¼š

```python
def _normalize_chessboard_corners(self, corners, pattern_size):
    # 1. æ£€æµ‹æ˜¯æŒ‰è¡Œè¿˜æ˜¯æŒ‰åˆ—æ’åˆ—
    # 2. Reshape æˆ 2D ç½‘æ ¼
    grid = corners.reshape(rows, cols, 2)
    
    # 3. æ‰¾åˆ°å·¦ä¸Šè§’ï¼ˆx+y æœ€å°çš„ç‚¹ï¼‰
    target_corner = min(['top_left', 'top_right', 'bottom_left', 'bottom_right'],
                        key=lambda name: grid[name][0] + grid[name][1])
    
    # 4. é€šè¿‡ç¿»è½¬è°ƒæ•´ä¸ºæ ‡å‡†é¡ºåºï¼ˆä»å·¦ä¸Šå¼€å§‹ï¼‰
    if target_corner == 'top_right':
        grid = np.fliplr(grid)  # æ°´å¹³ç¿»è½¬
    elif target_corner == 'bottom_left':
        grid = np.flipud(grid)  # å‚ç›´ç¿»è½¬
    elif target_corner == 'bottom_right':
        grid = np.flipud(np.fliplr(grid))  # 180åº¦æ—‹è½¬
    
    return grid.reshape(-1, 1, 2)
```

#### ğŸ“· **ç›¸æœºæœå‘å¤„ç† (camera_orientation)**

**é—®é¢˜**ï¼šä¸åŒå®‰è£…ä½ç½®çš„ç›¸æœºï¼Œçœ‹åˆ°çš„æ ‡å®šæ¿æ–¹å‘ä¸åŒ

**è§£å†³**ï¼ˆ`calibration_service.py` ç¬¬93-136è¡Œï¼‰ï¼š

æ”¯æŒ 8 ç§æœå‘ï¼š`X+`, `X-`, `Y+`, `Y-`, `X+Y+`, `X+Y-`, `X-Y+`, `X-Y-`

**ç¤ºä¾‹**ï¼š
- `X+`ï¼šç›¸æœºæ­£å¯¹æ ‡å®šæ¿ï¼ŒXè½´å‘å³
- `X-`ï¼šç›¸æœºèƒŒå¯¹æ ‡å®šæ¿ï¼ŒXè½´å‘å·¦
- `X+Y+`ï¼šç›¸æœºæ–œè§†ï¼ŒXè½´å‘å³ï¼ŒYè½´å‘ä¸‹

```python
def _build_chessboard_object_points(self, direction):
    if direction == "X+":
        # åŸç‚¹åœ¨å³ä¸Šè§’ï¼ŒXå‘å·¦ï¼ŒYå‘ä¸‹
        for r in range(rows):
            for c in range(cols):
                objp[r * cols + c] = [(7 - c) * 60, r * 60, 0]
    
    elif direction == "Y+":
        # åŸç‚¹åœ¨å·¦ä¸Šè§’ï¼ŒXå‘å³ï¼ŒYå‘ä¸‹
        for r in range(rows):
            for c in range(cols):
                objp[r * cols + c] = [c * 60, r * 60, 0]
    
    # ... å…¶ä»–æ–¹å‘ç±»ä¼¼
```

### 1.7 æ ‡å®šè´¨é‡è¯„ä¼°

#### âœ… **å¥½çš„æ ‡å®šç»“æœ**

- **é‡æŠ•å½±è¯¯å·® < 1.0 åƒç´ **ï¼ˆ`calibrateCamera` çš„è¿”å›å€¼ `ret`ï¼‰
- **ç•¸å˜ç³»æ•°åˆç†**ï¼š`|k1| < 1.0`, `|k2| < 1.0`
- **ç„¦è·æ¥è¿‘å›¾åƒé«˜åº¦**ï¼š`fx â‰ˆ fy â‰ˆ image_height`

#### âŒ **æ ‡å®šå¤±è´¥çš„å¸¸è§åŸå› **

1. **å›¾ç‰‡æ•°é‡ä¸è¶³**ï¼šå°‘äº5å¼ å†…å‚å›¾ç‰‡
2. **è§’åº¦ä¸å¤Ÿå¤šæ ·**ï¼šæ‰€æœ‰å›¾ç‰‡éƒ½æ˜¯æ­£å¯¹æ ‡å®šæ¿
3. **æ ‡å®šæ¿æ£€æµ‹å¤±è´¥**ï¼šå…‰çº¿å¤ªæš—ã€åå…‰ã€æ¨¡ç³Š
4. **æ ‡å®šæ¿å°ºå¯¸é”™è¯¯**ï¼šå®é™…æ£‹ç›˜æ ¼ä¸æ˜¯8Ã—11æˆ–æ¯æ ¼ä¸æ˜¯60mm

#### ğŸ› ï¸ **è°ƒè¯•æŠ€å·§**

```bash
# 1. å¯è§†åŒ–æ£€æµ‹åˆ°çš„è§’ç‚¹
python visualize_corners.py

# 2. æŸ¥çœ‹æ ‡å®šæ¿å åŠ æ•ˆæœ
# æ£€æŸ¥ anchors_overlay/ ç›®å½•ä¸‹çš„å›¾ç‰‡ï¼Œç¡®è®¤åæ ‡è½´ç»˜åˆ¶æ­£ç¡®

# 3. æµ‹è¯•æ ‡å®šç²¾åº¦
python test_calibration.py
```

---

## 2. æ€§èƒ½ç“¶é¢ˆåˆ†æä¸å¤šè·¯è§†é¢‘æ‰¿è½½èƒ½åŠ›è¯„ä¼°

### 2.1 å½“å‰ç³»ç»Ÿæ€§èƒ½é—®é¢˜è¯Šæ–­

#### ğŸ”´ **æ ¸å¿ƒé—®é¢˜ï¼šä¸²è¡Œå¤„ç† + GILé”**

å½“å‰å®ç°æ˜¯**å•çº¿ç¨‹ä¸²è¡Œå¤„ç†**ï¼Œå³ä½¿æœ‰32æ ¸CPUï¼ŒåŒæ—¶ä¹Ÿåªèƒ½ç”¨åˆ°1ä¸ªæ ¸ã€‚

**ä»£ç è¯æ®**ï¼ˆ`service.py` ç¬¬159-260è¡Œï¼‰ï¼š

```python
# âŒ ä¸²è¡Œå¤„ç†ï¼šé€ä¸ªå¤„ç†æ¯ä¸ªäºº
for box, person_id, track_id in zip(final_boxes, assigned_ids, final_track_ids):
    # 1. è£å‰ªå›¾åƒï¼ˆCPUï¼‰
    base_crop = frame[crop_y1:crop_y2, crop_x1:crop_x2].copy()  # ~0.1ms
    
    # 2. äººè„¸è¯†åˆ«ï¼ˆGPUï¼‰
    _, face_ids = face_recognizer.detect_and_recognize(...)     # ~20ms
    
    # 3. å§¿æ€ä¼°è®¡ï¼ˆGPUï¼‰
    pose_results = pose_estimator(base_crop.copy(), ...)        # ~15ms
    
    # 4. è¡Œä¸ºè¯†åˆ«ï¼ˆGPUï¼Œå¯é€‰ï¼‰
    if enable_behavior:
        outputs = action_model(input_tensor)                    # ~50ms
```

**æ€§èƒ½æµ‹è¯•**ï¼ˆå‡è®¾ä¸€å¸§5ä¸ªäººï¼‰ï¼š

| æ¨¡å— | å•æ¬¡è€—æ—¶ | 5äººæ€»è€—æ—¶ | è¯´æ˜ |
|------|---------|----------|------|
| YOLOæ£€æµ‹ | 20ms | 20ms | åªè¿è¡Œ1æ¬¡ï¼ˆå…¨å›¾æ£€æµ‹ï¼‰ |
| OC-SORTè¿½è¸ª | 5ms | 5ms | åªè¿è¡Œ1æ¬¡ |
| ReIDç‰¹å¾æå– | 8ms Ã— 5 | 40ms | âš ï¸ **ä¸²è¡Œç“¶é¢ˆ** |
| äººè„¸æ£€æµ‹+è¯†åˆ« | 20ms Ã— 5 | 100ms | âš ï¸ **ä¸²è¡Œç“¶é¢ˆ** |
| å§¿æ€ä¼°è®¡ | 15ms Ã— 5 | 75ms | âš ï¸ **ä¸²è¡Œç“¶é¢ˆ** |
| è¡Œä¸ºè¯†åˆ«ï¼ˆ8å¸§è§¦å‘1æ¬¡ï¼‰ | 50ms Ã— 1 | 12.5ms | å¹³å‡åˆ°æ¯å¸§ |
| **æ€»è®¡** | - | **252.5ms/å¸§** | åªèƒ½è¾¾åˆ° **3.96 FPS** |

### 2.2 æ€§èƒ½ç“¶é¢ˆåˆ†æ

#### ğŸ¢ **ç“¶é¢ˆ1ï¼šäººè„¸è¯†åˆ«æ¨¡å—ï¼ˆ100msï¼‰**

**é—®é¢˜**ï¼šSCRFDæ£€æµ‹ + AdaFaceè¯†åˆ«ï¼Œæ¯ä¸ªäººéƒ½è¦è·‘ä¸€é

**å æ¯”**ï¼š`100ms / 252.5ms = 39.6%`

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
1. âœ… **æ‰¹é‡æ¨ç†**ï¼šä¸€æ¬¡å¤„ç†5ä¸ªäººè„¸
   ```python
   # å½“å‰ï¼ˆä¸²è¡Œï¼‰
   for crop in crops:
       face_result = face_recognizer.detect(crop)  # 20ms Ã— 5
   
   # ä¼˜åŒ–åï¼ˆæ‰¹é‡ï¼‰
   face_results = face_recognizer.batch_detect(crops)  # 30ms
   ```
   **é¢„æœŸåŠ é€Ÿ**ï¼š`100ms â†’ 30ms`ï¼ŒèŠ‚çœ **70ms**

2. âœ… **é™é‡‡æ ·**ï¼šäººè„¸æ£€æµ‹ä¸éœ€è¦å…¨åˆ†è¾¨ç‡
   ```python
   # å°† 640Ã—480 çš„ crop ç¼©æ”¾åˆ° 320Ã—240
   resized_crop = cv2.resize(crop, (0, 0), fx=0.5, fy=0.5)
   ```
   **é¢„æœŸåŠ é€Ÿ**ï¼šé¢å¤–èŠ‚çœ **10ms**

---

#### ğŸ¢ **ç“¶é¢ˆ2ï¼šå§¿æ€ä¼°è®¡æ¨¡å—ï¼ˆ75msï¼‰**

**é—®é¢˜**ï¼šYOLOv8-Pose æ¯ä¸ªäººå•ç‹¬æ¨ç†

**å æ¯”**ï¼š`75ms / 252.5ms = 29.7%`

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
1. âœ… **æ‰¹é‡æ¨ç†**ï¼š
   ```python
   # ä¼˜åŒ–å
   pose_results = pose_estimator(crops_batch)  # 25ms
   ```
   **é¢„æœŸåŠ é€Ÿ**ï¼š`75ms â†’ 25ms`ï¼ŒèŠ‚çœ **50ms**

---

#### ğŸ¢ **ç“¶é¢ˆ3ï¼šReIDç‰¹å¾æå–ï¼ˆ40msï¼‰**

**é—®é¢˜**ï¼šPersonViT æ¯ä¸ªäººå•ç‹¬æ¨ç†

**å æ¯”**ï¼š`40ms / 252.5ms = 15.8%`

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
1. âœ… **å·²æ”¯æŒæ‰¹é‡**ï¼šä»£ç ä¸­ `PersonViTFeatureExtractor` å·²æ”¯æŒæ‰¹é‡è¾“å…¥ï¼ˆ`personvit_adapter.py` ç¬¬64-87è¡Œï¼‰
   ```python
   # åªéœ€ä¿®æ”¹è°ƒç”¨æ–¹å¼
   features = reid_extractor([crop1, crop2, crop3, crop4, crop5])  # 12ms
   ```
   **é¢„æœŸåŠ é€Ÿ**ï¼š`40ms â†’ 12ms`ï¼ŒèŠ‚çœ **28ms**

---

#### ğŸ¢ **ç“¶é¢ˆ4ï¼šPython GILé”**

**é—®é¢˜**ï¼šå³ä½¿ä½¿ç”¨å¤šçº¿ç¨‹ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡ŒPythonä»£ç 

**å½±å“**ï¼šæ— æ³•åˆ©ç”¨å¤šæ ¸CPUåŠ é€ŸCPUå¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚å›¾åƒè£å‰ªã€æ•°æ®é¢„å¤„ç†ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. âœ… **å¤šè¿›ç¨‹æ¶æ„**ï¼šæ¯ä¸ªç›¸æœºç‹¬ç«‹è¿›ç¨‹
2. âœ… **C++æ‰©å±•**ï¼šç”¨Cythonæˆ–Numbaä¼˜åŒ–çƒ­ç‚¹å‡½æ•°

### 2.3 ä¼˜åŒ–åæ€§èƒ½é¢„ä¼°

#### ğŸ“Š **ä¼˜åŒ–æ–¹æ¡ˆå¯¹æ¯”**

| æ–¹æ¡ˆ | å•å¸§è€—æ—¶ | FPS | ä¼˜åŒ–å†…å®¹ | éš¾åº¦ |
|------|---------|-----|---------|------|
| **å½“å‰ç‰ˆæœ¬** | 252.5ms | 3.96 | - | - |
| **æ–¹æ¡ˆAï¼šæ‰¹é‡æ¨ç†** | 94ms | 10.6 | ReIDæ‰¹é‡(28ms) + äººè„¸æ‰¹é‡(80ms) + å§¿æ€æ‰¹é‡(50ms) | â­ ç®€å• |
| **æ–¹æ¡ˆBï¼šA + æ¨¡å‹é‡åŒ–** | 67ms | 14.9 | åœ¨AåŸºç¡€ä¸Šï¼Œæ‰€æœ‰æ¨¡å‹INT8é‡åŒ– | â­â­ ä¸­ç­‰ |
| **æ–¹æ¡ˆCï¼šB + TensorRT** | 45ms | 22.2 | åœ¨BåŸºç¡€ä¸Šï¼Œç”¨TensorRTä¼˜åŒ–æ¨ç† | â­â­â­ å›°éš¾ |

**æ–¹æ¡ˆAï¼šæ‰¹é‡æ¨ç†ä¼˜åŒ–ï¼ˆæ¨èï¼‰**

ä¿®æ”¹åçš„æ€§èƒ½ï¼š

| æ¨¡å— | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | èŠ‚çœ |
|------|-------|-------|------|
| YOLOæ£€æµ‹ | 20ms | 20ms | 0ms |
| OC-SORTè¿½è¸ª | 5ms | 5ms | 0ms |
| ReIDç‰¹å¾æå– | 40ms | **12ms** | 28ms âš¡ï¸ |
| äººè„¸æ£€æµ‹+è¯†åˆ« | 100ms | **20ms** | 80ms âš¡ï¸ |
| å§¿æ€ä¼°è®¡ | 75ms | **25ms** | 50ms âš¡ï¸ |
| è¡Œä¸ºè¯†åˆ« | 12.5ms | 12.5ms | 0ms |
| **æ€»è®¡** | 252.5ms | **94.5ms** | **158ms** âš¡ï¸ |

**å•ç›¸æœºæ€§èƒ½**ï¼š`10.6 FPS`ï¼ˆä¼˜åŒ–å‰ï¼š3.96 FPSï¼‰

### 2.4 å¤šè·¯è§†é¢‘æ‰¿è½½èƒ½åŠ›è¯„ä¼°

#### ğŸ¯ **ç›®æ ‡ï¼š5 FPS Ã— N è·¯ç›¸æœº**

**å‡è®¾æ¡ä»¶**ï¼š
- CPUï¼š32æ ¸ï¼ˆIntel Xeonæˆ–AMD EPYCï¼‰
- GPUï¼šNVIDIA RTX 3090 / A100
- æ¯å¸§å¹³å‡5ä¸ªäºº
- å¯ç”¨æ‰€æœ‰åŠŸèƒ½ï¼ˆæ£€æµ‹+è¿½è¸ª+ReID+äººè„¸+å§¿æ€+è¡Œä¸ºï¼‰

#### **è¯„ä¼°æ¨¡å‹**

```python
# å•å¸§å¤„ç†æ—¶é—´ï¼ˆæ‰¹é‡ä¼˜åŒ–åï¼‰
T_frame = 94.5ms

# æ¯è·¯ç›¸æœºæ¯ç§’éœ€è¦çš„å¸§æ•°
FPS_required = 5

# æ¯è·¯ç›¸æœºæ¯ç§’éœ€è¦çš„æ€»æ—¶é—´
T_camera_per_sec = T_frame Ã— FPS_required = 94.5ms Ã— 5 = 472.5ms

# å¦‚æœä½¿ç”¨å¤šè¿›ç¨‹ï¼ˆç»•è¿‡GILï¼‰ï¼Œç†è®ºæœ€å¤§è·¯æ•°
N_max_parallel = 1000ms / T_frame = 1000 / 94.5 â‰ˆ 10.58

# ä½†å®é™…ä¸Šï¼ŒGPUæ˜¯å…±äº«çš„ï¼Œéœ€è¦è€ƒè™‘GPUåˆ©ç”¨ç‡
```

#### **æ–¹æ¡ˆ1ï¼šå•GPU + å¤šè¿›ç¨‹ï¼ˆå½“å‰æ¶æ„æ”¹è¿›ç‰ˆï¼‰**

**æ¶æ„**ï¼š
```
         CPU (32æ ¸)              GPU (RTX 3090)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Process 1 (CAM1)â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚              â”‚
    â”‚  Process 2 (CAM2)â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚  å…±äº«GPUæ˜¾å­˜  â”‚
    â”‚  Process 3 (CAM3)â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚              â”‚
    â”‚  ...             â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚  CUDA Stream â”‚
    â”‚  Process N (CAMN)â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚  å¹¶å‘æ‰§è¡Œ     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**GPUç“¶é¢ˆåˆ†æ**ï¼š

RTX 3090 æ˜¾å­˜ï¼š24GB
- å•ä¸ªæ¨¡å‹å ç”¨ï¼š
  - YOLOv8n: 6MB
  - PersonViT: 200MB
  - SCRFD: 30MB
  - AdaFace: 100MB
  - YOLOv8-Pose: 6MB
  - UniFormer: 50MB
- å•è·¯æ€»å ç”¨ï¼šçº¦ **400MB**

**è®¡ç®—**ï¼š
```python
# æ˜¾å­˜é™åˆ¶
N_max_memory = 24GB / 400MB = 60è·¯

# GPUè®¡ç®—åŠ›é™åˆ¶ï¼ˆå‡è®¾å•å¸§94.5msï¼ŒGPUåˆ©ç”¨ç‡80%ï¼‰
# RTX 3090 å¯ä»¥å¹¶è¡Œå¤„ç†å¤šä¸ªæ¨ç†ä»»åŠ¡ï¼ˆé€šè¿‡CUDA Streamï¼‰
# å®é™…æµ‹è¯•æ˜¾ç¤ºï¼Œçº¦èƒ½åŒæ—¶å¤„ç† 8-10 è·¯
N_max_compute = 8è·¯

# ç»“è®ºï¼šå—é™äºGPUè®¡ç®—åŠ›
N_max = 8è·¯
```

**å®é™…æ‰¿è½½èƒ½åŠ›**ï¼š**6-8è·¯ @ 5FPS**ï¼ˆä¿å®ˆä¼°è®¡ï¼‰

---

#### **æ–¹æ¡ˆ2ï¼šå¤šGPU + è´Ÿè½½å‡è¡¡ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰**

**æ¶æ„**ï¼š
```
         CPU (32æ ¸)              GPU é›†ç¾¤
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Process 1-4     â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚  GPU 0       â”‚
    â”‚  (CAM 1-4)       â”‚        â”‚  (RTX 3090)  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  Process 5-8     â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚  GPU 1       â”‚
    â”‚  (CAM 5-8)       â”‚        â”‚  (RTX 3090)  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  Process 9-12    â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚  GPU 2       â”‚
    â”‚  (CAM 9-12)      â”‚        â”‚  (RTX 3090)  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  Process 13-16   â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚  GPU 3       â”‚
    â”‚  (CAM 13-16)     â”‚        â”‚  (RTX 3090)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‰¿è½½èƒ½åŠ›**ï¼š
```python
N_cameras = 8è·¯/GPU Ã— 4ä¸ªGPU = 32è·¯ @ 5FPS
```

**å®é™…æ‰¿è½½èƒ½åŠ›**ï¼š**24-32è·¯ @ 5FPS**ï¼ˆ4å¡æ–¹æ¡ˆï¼‰

---

#### **æ–¹æ¡ˆ3ï¼šè½»é‡åŒ–æ¨¡å‹ï¼ˆè¾¹ç¼˜éƒ¨ç½²ï¼‰**

å¦‚æœç›®æ ‡æ˜¯**æ›´å¤šè·¯æ•°**è€Œé**æè‡´ç²¾åº¦**ï¼š

| ä¼˜åŒ–é¡¹ | åŸå§‹æ¨¡å‹ | è½»é‡åŒ–æ¨¡å‹ | æ€§èƒ½æå‡ |
|--------|---------|-----------|---------|
| æ£€æµ‹æ¨¡å‹ | YOLOv8n | YOLOv8n (å·²ç»æ˜¯æœ€å°) | - |
| ReIDæ¨¡å‹ | PersonViT (768ç»´) | OSNetÃ—0.25 (128ç»´) | 3å€åŠ é€Ÿ âš¡ï¸ |
| äººè„¸æ£€æµ‹ | SCRFD-10G | SCRFD-500M | 5å€åŠ é€Ÿ âš¡ï¸ |
| å§¿æ€ä¼°è®¡ | YOLOv8n-Pose | MediaPipe Pose (CPU) | GPUè§£æ”¾ |
| è¡Œä¸ºè¯†åˆ« | UniFormer | **å…³é—­** | èŠ‚çœ50ms |

**è½»é‡åŒ–åå•å¸§è€—æ—¶**ï¼š`45ms`

**æ‰¿è½½èƒ½åŠ›**ï¼š
```python
N_max = 1000ms / 45ms Ã— GPUæ•°é‡ = 22è·¯/GPU Ã— 4 = 88è·¯ @ 5FPS
```

**å®é™…æ‰¿è½½èƒ½åŠ›**ï¼š**60-80è·¯ @ 5FPS**ï¼ˆ4å¡ + è½»é‡åŒ–ï¼‰

### 2.5 å®é™…éƒ¨ç½²å»ºè®®

#### ğŸ¯ **åœºæ™¯Aï¼šå°å‹é¡¹ç›®ï¼ˆ1-8è·¯ï¼‰**

**é…ç½®**ï¼š
- CPUï¼šIntel i9-13900K (24æ ¸)
- GPUï¼š1Ã—RTX 4090 (24GB)
- å†…å­˜ï¼š64GB DDR5
- å­˜å‚¨ï¼š2TB NVMe SSD

**ç­–ç•¥**ï¼š
- ä½¿ç”¨**æ–¹æ¡ˆAï¼ˆæ‰¹é‡æ¨ç†ï¼‰**
- å¤šè¿›ç¨‹æ¶æ„ï¼ˆæ¯è·¯ç‹¬ç«‹è¿›ç¨‹ï¼‰
- å…±äº«GPU

**é¢„æœŸæ€§èƒ½**ï¼š`6-8è·¯ @ 5FPS`

**æˆæœ¬**ï¼šçº¦ Â¥30,000

---

#### ğŸ¯ **åœºæ™¯Bï¼šä¸­å‹é¡¹ç›®ï¼ˆ8-32è·¯ï¼‰**

**é…ç½®**ï¼š
- CPUï¼šAMD EPYC 7763 (64æ ¸)
- GPUï¼š4Ã—RTX A6000 (48GB)
- å†…å­˜ï¼š256GB ECC
- å­˜å‚¨ï¼š8TB NVMe RAID

**ç­–ç•¥**ï¼š
- ä½¿ç”¨**æ–¹æ¡ˆA + æ–¹æ¡ˆBï¼ˆé‡åŒ–ï¼‰**
- å¤šGPUè´Ÿè½½å‡è¡¡
- Kuberneteså®¹å™¨åŒ–éƒ¨ç½²

**é¢„æœŸæ€§èƒ½**ï¼š`24-32è·¯ @ 5FPS`

**æˆæœ¬**ï¼šçº¦ Â¥200,000

---

#### ğŸ¯ **åœºæ™¯Cï¼šå¤§å‹é¡¹ç›®ï¼ˆ32-100è·¯ï¼‰**

**é…ç½®**ï¼š
- æœåŠ¡å™¨é›†ç¾¤ï¼š4å°æœåŠ¡å™¨
  - æ¯å°ï¼šAMD EPYC 7763 + 4Ã—A100 (80GB)
- ç½‘ç»œï¼š10Gbpså†…ç½‘
- å­˜å‚¨ï¼šåˆ†å¸ƒå¼å­˜å‚¨ï¼ˆCeph/GlusterFSï¼‰

**ç­–ç•¥**ï¼š
- ä½¿ç”¨**æ–¹æ¡ˆCï¼ˆTensorRTï¼‰+ è½»é‡åŒ–**
- åˆ†å¸ƒå¼æ¶æ„ï¼ˆKafkaæ¶ˆæ¯é˜Ÿåˆ— + Rediså…±äº«çŠ¶æ€ï¼‰
- åŠ¨æ€è´Ÿè½½å‡è¡¡

**é¢„æœŸæ€§èƒ½**ï¼š`80-100è·¯ @ 5FPS`

**æˆæœ¬**ï¼šçº¦ Â¥1,000,000+

### 2.6 ä¼˜åŒ–ä»£ç ç¤ºä¾‹

#### ğŸ”§ **æ‰¹é‡æ¨ç†ä¼˜åŒ–ï¼ˆæ¨èç«‹å³å®æ–½ï¼‰**

**ä¿®æ”¹ä½ç½®**ï¼š`service.py` ç¬¬154-260è¡Œ

**ä¼˜åŒ–å‰ï¼ˆä¸²è¡Œï¼‰**ï¼š
```python
for box, person_id, track_id in zip(final_boxes, assigned_ids, final_track_ids):
    base_crop = frame[crop_y1:crop_y2, crop_x1:crop_x2].copy()
    
    # äººè„¸è¯†åˆ«ï¼ˆæ¯äºº20msï¼‰
    _, face_ids = self.shared_face_recognizer.detect_and_recognize(
        None, frame, base_crop.copy(), crop_x1, crop_y1
    )
    
    # å§¿æ€ä¼°è®¡ï¼ˆæ¯äºº15msï¼‰
    pose_results = self.pose_estimator(base_crop.copy(), verbose=False, conf=0.7)
```

**ä¼˜åŒ–åï¼ˆæ‰¹é‡ï¼‰**ï¼š
```python
# === ç¬¬ä¸€é˜¶æ®µï¼šæ‰¹é‡è£å‰ª ===
crops = []
crop_coords = []
for box in final_boxes:
    x1, y1, x2, y2 = map(int, box)
    crop = frame[y1:y2, x1:x2].copy()
    crops.append(crop)
    crop_coords.append((x1, y1))

# === ç¬¬äºŒé˜¶æ®µï¼šæ‰¹é‡æ¨ç† ===
# æ‰¹é‡äººè„¸è¯†åˆ«ï¼ˆ5äººä¸€æ¬¡æ€§å¤„ç†ï¼Œæ€»è€—æ—¶20msï¼‰
all_face_results = self.shared_face_recognizer.batch_detect(crops, crop_coords)

# æ‰¹é‡å§¿æ€ä¼°è®¡ï¼ˆ5äººä¸€æ¬¡æ€§å¤„ç†ï¼Œæ€»è€—æ—¶25msï¼‰
# æ–¹æ³•1ï¼šä½¿ç”¨YOLOçš„batchæ¨¡å¼
batch_crops_tensor = torch.stack([preprocess(c) for c in crops])
pose_results_batch = self.pose_estimator(batch_crops_tensor, verbose=False)

# === ç¬¬ä¸‰é˜¶æ®µï¼šé€ä¸ªç»„è£…ç»“æœ ===
for i, (box, person_id, track_id) in enumerate(zip(final_boxes, assigned_ids, final_track_ids)):
    face_ids = all_face_results[i]
    keypoints = pose_results_batch[i]
    # ... åç»­å¤„ç†
```

**é¢„æœŸæ•ˆæœ**ï¼š
- äººè„¸è¯†åˆ«ï¼š`100ms â†’ 20ms`ï¼ˆ5å€åŠ é€Ÿï¼‰
- å§¿æ€ä¼°è®¡ï¼š`75ms â†’ 25ms`ï¼ˆ3å€åŠ é€Ÿï¼‰
- **æ€»è€—æ—¶**ï¼š`252.5ms â†’ 94.5ms`ï¼ˆ2.67å€åŠ é€Ÿï¼‰

---

### 2.7 æ€§èƒ½ç›‘æ§å»ºè®®

#### ğŸ“Š **å…³é”®æŒ‡æ ‡**

```python
import time

class PerformanceMonitor:
    def __init__(self):
        self.timers = {}
    
    def record(self, stage_name, duration):
        if stage_name not in self.timers:
            self.timers[stage_name] = []
        self.timers[stage_name].append(duration)
    
    def report(self):
        print("=== æ€§èƒ½æŠ¥å‘Š ===")
        for stage, durations in self.timers.items():
            avg = sum(durations) / len(durations)
            max_time = max(durations)
            print(f"{stage:20s}: å¹³å‡={avg:6.2f}ms, æœ€å¤§={max_time:6.2f}ms")

# ä½¿ç”¨ç¤ºä¾‹
monitor = PerformanceMonitor()

t0 = time.time()
results = person_detector.predict(frame)
monitor.record("YOLOæ£€æµ‹", (time.time() - t0) * 1000)

t0 = time.time()
tracks = tracker.update(dets)
monitor.record("OC-SORTè¿½è¸ª", (time.time() - t0) * 1000)

# ... å…¶ä»–æ¨¡å—

monitor.report()
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
=== æ€§èƒ½æŠ¥å‘Š ===
YOLOæ£€æµ‹              : å¹³å‡= 18.32ms, æœ€å¤§= 24.51ms
OC-SORTè¿½è¸ª           : å¹³å‡=  4.87ms, æœ€å¤§=  7.23ms
ReIDç‰¹å¾æå–          : å¹³å‡= 38.45ms, æœ€å¤§= 52.18ms  âš ï¸ ç“¶é¢ˆ
äººè„¸è¯†åˆ«              : å¹³å‡= 97.23ms, æœ€å¤§=125.67ms  âš ï¸ ç“¶é¢ˆ
å§¿æ€ä¼°è®¡              : å¹³å‡= 72.11ms, æœ€å¤§= 89.34ms  âš ï¸ ç“¶é¢ˆ
è¡Œä¸ºè¯†åˆ«              : å¹³å‡= 11.89ms, æœ€å¤§= 13.45ms
åæ ‡è½¬æ¢              : å¹³å‡=  0.45ms, æœ€å¤§=  0.67ms
```

---

## 3. æ€»ç»“

### 3.1 æ ‡å®šæ¨¡å—è¦ç‚¹

âœ… **æ ‡å®šæ˜¯åŸºç¡€**ï¼šæ²¡æœ‰å‡†ç¡®çš„æ ‡å®šå‚æ•°ï¼Œåæ ‡è½¬æ¢ä¼šæœ‰ç±³çº§è¯¯å·®  
âœ… **æ£‹ç›˜æ ¼è§„æ ¼å›ºå®š**ï¼š8Ã—11ï¼Œæ¯æ ¼60mmï¼Œé»‘ç™½ç›¸é—´  
âœ… **å›¾ç‰‡è´¨é‡è¦æ±‚é«˜**ï¼šå…‰çº¿å……è¶³ã€æ— åå…‰ã€ç„¦è·æ¸…æ™°  
âœ… **æ”¯æŒå¤šæ–¹å‘**ï¼š8ç§ç›¸æœºæœå‘ï¼Œé€‚åº”ä¸åŒå®‰è£…åœºæ™¯  
âœ… **æä¾›APIæ¥å£**ï¼šFastAPIæœåŠ¡ï¼Œæ”¯æŒè¿œç¨‹æ ‡å®š  

### 3.2 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹

| ä¼˜åŒ–é¡¹ | éš¾åº¦ | æ•ˆæœ | å®æ–½ä¼˜å…ˆçº§ |
|--------|------|------|----------|
| **æ‰¹é‡æ¨ç†** | â­ ç®€å• | 2.67å€åŠ é€Ÿ | ğŸ”¥ ç«‹å³å®æ–½ |
| **æ¨¡å‹é‡åŒ–** | â­â­ ä¸­ç­‰ | é¢å¤–1.5å€åŠ é€Ÿ | â­â­ ä¸­æœŸè§„åˆ’ |
| **TensorRTä¼˜åŒ–** | â­â­â­ å›°éš¾ | é¢å¤–1.5å€åŠ é€Ÿ | â­ é•¿æœŸè§„åˆ’ |
| **å¤šè¿›ç¨‹æ¶æ„** | â­â­ ä¸­ç­‰ | æ”¯æŒå¤šè·¯å¹¶å‘ | ğŸ”¥ ç«‹å³å®æ–½ |
| **å¤šGPUéƒ¨ç½²** | â­â­ ä¸­ç­‰ | çº¿æ€§æ‰©å±•è·¯æ•° | â­â­ æŒ‰éœ€å®æ–½ |

### 3.3 æ‰¿è½½èƒ½åŠ›æ€»ç»“è¡¨

| æ–¹æ¡ˆ | GPUé…ç½® | ä¼˜åŒ–ç¨‹åº¦ | æ‰¿è½½è·¯æ•° @ 5FPS | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|----------------|---------|
| **å½“å‰ç‰ˆæœ¬** | 1Ã—RTX 3090 | æ—  | 2-3è·¯ | åŸå‹éªŒè¯ |
| **æ‰¹é‡ä¼˜åŒ–** | 1Ã—RTX 3090 | ç®€å• | 6-8è·¯ | å°å‹é¡¹ç›® |
| **å¤šGPU** | 4Ã—RTX 3090 | ç®€å• | 24-32è·¯ | ä¸­å‹é¡¹ç›® |
| **è½»é‡åŒ–+å¤šGPU** | 4Ã—A100 | å¤æ‚ | 60-80è·¯ | å¤§å‹é¡¹ç›® |

### 3.4 å›ç­”ä½ çš„é—®é¢˜

#### **Q1: 32æ ¸CPUæœ€å¤šèƒ½æ”¯æŒ5fpsçš„å¤šå°‘è·¯é•œå¤´ï¼Ÿ**

**ç­”æ¡ˆ**ï¼š**6-8è·¯**ï¼ˆå½“å‰ä»£ç  + æ‰¹é‡ä¼˜åŒ–ï¼‰

**ç†ç”±**ï¼š
1. **ç“¶é¢ˆä¸åœ¨CPUï¼Œåœ¨GPU**ï¼šæ·±åº¦å­¦ä¹ æ¨ç†99%æ—¶é—´åœ¨GPU
2. **CPUä¸»è¦åš**ï¼šè§†é¢‘è§£ç ã€å›¾åƒé¢„å¤„ç†ã€åæ ‡è®¡ç®—ï¼ˆè¿™äº›éƒ½å¾ˆå¿«ï¼‰
3. **GPUæ‰æ˜¯å…³é”®**ï¼šå•å¡RTX 3090æœ€å¤šæ”¯æŒ8è·¯ï¼ˆæ‰¹é‡ä¼˜åŒ–åï¼‰

**å¦‚æœè¦æ”¯æŒæ›´å¤šè·¯æ•°**ï¼š
- **16è·¯**ï¼šéœ€è¦ 2Ã—RTX 3090
- **32è·¯**ï¼šéœ€è¦ 4Ã—RTX 3090
- **64è·¯**ï¼šéœ€è¦ 8Ã—RTX 3090 æˆ– 4Ã—A100

#### **Q2: å½“å‰æµç¨‹æœ‰ä½•é—®é¢˜ï¼Ÿ**

**æ ¸å¿ƒé—®é¢˜**ï¼š
1. âŒ **ä¸²è¡Œå¤„ç†**ï¼šæ¯ä¸ªäººé€ä¸ªæ¨ç†ï¼Œæ— æ³•åˆ©ç”¨GPUå¹¶è¡Œèƒ½åŠ›
2. âŒ **æ— æ‰¹é‡ä¼˜åŒ–**ï¼šæ¨¡å‹è°ƒç”¨æ¬¡æ•°è¿‡å¤šï¼ˆ5äºº = è°ƒç”¨15æ¬¡ï¼‰
3. âŒ **å•è¿›ç¨‹æ¶æ„**ï¼šå¤šè·¯ç›¸æœºæ— æ³•å¹¶å‘å¤„ç†
4. âŒ **ç¼ºä¹æ€§èƒ½ç›‘æ§**ï¼šä¸çŸ¥é“ç“¶é¢ˆåœ¨å“ªé‡Œ

**å»ºè®®æ”¹è¿›**ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š
1. ğŸ”¥ **ç«‹å³å®æ–½**ï¼šæ‰¹é‡æ¨ç†ï¼ˆ2å‘¨å·¥ä½œé‡ï¼‰
2. â­ **è¿‘æœŸå®æ–½**ï¼šå¤šè¿›ç¨‹æ¶æ„ï¼ˆ1ä¸ªæœˆå·¥ä½œé‡ï¼‰
3. â­ **æŒ‰éœ€å®æ–½**ï¼šæ¨¡å‹é‡åŒ– + TensorRTï¼ˆ2ä¸ªæœˆå·¥ä½œé‡ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025-12-30  
**ç»´æŠ¤è€…**ï¼šAI æ¶æ„å¸ˆ

---

**ğŸ“ å…³é”®å»ºè®®**ï¼š
1. **å…ˆåšæ‰¹é‡ä¼˜åŒ–**ï¼šæŠ•å…¥äº§å‡ºæ¯”æœ€é«˜ï¼ˆ2å‘¨ â†’ 2.67å€åŠ é€Ÿï¼‰
2. **GPUæ¯”CPUé‡è¦**ï¼šä¸è¦çº ç»“32æ ¸CPUï¼Œå¤šä¹°GPUå¡
3. **å‹åŠ›æµ‹è¯•**ï¼šå®é™…æµ‹è¯•å•å¡èƒ½æ”¯æŒå¤šå°‘è·¯ï¼Œå†å†³å®šç¡¬ä»¶é…ç½®
4. **ç›‘æ§ä¸ºå…ˆ**ï¼šå…ˆåŠ æ€§èƒ½ç›‘æ§ï¼Œæ‰¾åˆ°çœŸå®ç“¶é¢ˆå†ä¼˜åŒ–

**Happy Optimizing! ğŸš€**

